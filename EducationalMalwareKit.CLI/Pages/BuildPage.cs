using System;
using System.Threading;
using EasyConsole;
using EducationalMalwareKit.Assembler;
using EducationalMalwareKit.Assembler.Assemblers;

namespace EducationalMalwareKit.CLI.Pages
{
    public class BuildPage : Page
    {
        public BuildPage(Program program) : base("Build", program)
        {
        }

        public override void Display()
        {
            base.Display();

            Output.WriteLine(ConsoleColor.Cyan, "Creating working dir ...");
            Kernel.MalwareBuild.WorkingDir = Kernel.CreateWorkingDir();

            Output.WriteLine(ConsoleColor.Green, $"Created: {Kernel.MalwareBuild.WorkingDir}");
            Thread.Sleep(1000);
            
            Kernel.MalwareAssembler.AssembleMalware();

            if (Kernel.MalwareBuild.UserOptions.CleanOutputDirectory)
            {
                Kernel.MalwareAssembler.CleanWorkingDir();
            }

            if (Kernel.MalwareBuild.UserOptions.PackageOutput)
            {
                Kernel.MalwareAssembler.CompressOutput(Kernel.UpxPath);
            }

            Output.WriteLine(ConsoleColor.Cyan, "Build output in:");
            Output.WriteLine(ConsoleColor.Cyan, Kernel.MalwareBuild.WorkingDir);

            Output.WriteLine(ConsoleColor.Green, "\nBuild finished");

            Input.ReadString("Press [Enter] to navigate home");
            Program.NavigateHome();
        }

    }
}
