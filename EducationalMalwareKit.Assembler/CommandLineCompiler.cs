using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using EducationalMalwareKit.Domain.Build;
using EducationalMalwareKit.Domain.Build.Compilers;

namespace EducationalMalwareKit.Assembler
{
    public static class CommandLineCompiler
    {
        public static void Compile(MalwareBuild malwareBuild, CompilerArguments compilerArguments)
        {            
            var startInfo = new ProcessStartInfo()
            {
                Arguments =
                    "%comspec% /k \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\Common7\\Tools\\VsDevCmd.bat\"",
                FileName = "cmd.exe",
                RedirectStandardError = true,
                RedirectStandardInput = true,
                RedirectStandardOutput = false,
                UseShellExecute = false,
                WorkingDirectory = compilerArguments.WorkingDirectory
            };

            var cmd = new Process();
            cmd.StartInfo = startInfo;            

            cmd.Start();
            cmd.StandardInput.WriteLine(compilerArguments.ToString());

            cmd.WaitForExit();
        }
    }
}
