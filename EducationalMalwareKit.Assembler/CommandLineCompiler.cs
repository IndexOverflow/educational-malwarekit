using System;
using System.Diagnostics;
using EducationalMalwareKit.Domain.Build;

namespace EducationalMalwareKit.Assembler
{
    public static class CommandLineCompiler
    {
        public static Process Compile(MalwareBuild malwareBuild)
        {
            var startInfo = new ProcessStartInfo()
            {
                Arguments =
                    "%comspec% /k \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\Common7\\Tools\\VsDevCmd.bat\"",
                FileName = "cmd.exe",
                RedirectStandardError = false,
                RedirectStandardInput = true,
                RedirectStandardOutput = false,
                UseShellExecute = false,
                WorkingDirectory = malwareBuild.WorkingDir,      
                CreateNoWindow = false
            };

            var cmd = new Process
            {
                StartInfo = startInfo,
                EnableRaisingEvents = true
            };

            cmd.Start();
            cmd.StandardInput.WriteLine(malwareBuild.CompilerArguments.ToString());
            cmd.StandardInput.WriteLine("exit");

            return cmd;
        }
    }
}
