using System;
using EducationalMalwareKit.Domain.Build.Compilers;
using EducationalMalwareKit.Domain.Payloads;

namespace EducationalMalwareKit.Domain.Build
{
    public class MalwareBuild
    {
        public PayloadManifest Manifest { get; private set; }
        public UserOptions UserOptions { get; set; }
        public CompilerArguments CompilerArguments { get; private set; }
        public string WorkingDir { get; set; }
        public string CompiledPayloadPath { get; set; }

        private string _payloadFileName;

        public string PayloadFileName
        {
            get
            {
                return _payloadFileName + ".dll";
            }
        }

        public MalwareBuild(string payloadFileName)
        {
            _payloadFileName = payloadFileName;
        }

        public void SetComponents(string buildToolsPath, PayloadManifest payloadManifest)
        {
            Manifest = payloadManifest;

            switch (Manifest.Language)
            {
                case PayloadManifest.LanguageCPlusPlus:
                    CompilerArguments = new CPlusPlusCompilerArguments(buildToolsPath);
                    break;
                case PayloadManifest.LanguageCSharp:
                    CompilerArguments = new CSharpCompilerArguments(buildToolsPath);
                    break;
                default:
                    throw new ArgumentException($"Tookit does not recognize language \"{Manifest.Language}\"");
            }
        }
    }
}
